#!/usr/bin/env python

from Thinkpol.supervisor import Node
from multiprocessing import cpu_count
import gevent
import signal

CMD = "./worker"

if __name__ == '__main__':
	execfile("config")
	MONITOR_ADDR = (MONITOR_WORKEREND_ADDR, MONITOR_WORKEREND_PORT)

	node = Node()
	node.start(CMD, cpu_count())
	node.connect(MONITOR_ADDR)

	gevent.signal(signal.SIGTERM, node.stop)
	gevent.signal(signal.SIGQUIT, node.stop)
	gevent.signal(signal.SIGINT, node.stop)

	node._keep_alive()